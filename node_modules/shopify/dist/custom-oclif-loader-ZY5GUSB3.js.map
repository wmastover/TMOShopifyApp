{
  "version": 3,
  "sources": ["../../cli-kit/src/public/node/custom-oclif-loader.ts"],
  "sourcesContent": ["import {fileExistsSync} from './fs.js'\nimport {cwd, joinPath, sniffForPath} from './path.js'\nimport {execaSync} from 'execa'\nimport {Command, Config} from '@oclif/core'\nimport {Options} from '@oclif/core/lib/interfaces/plugin.js'\n\nexport class ShopifyConfig extends Config {\n  constructor(options: Options) {\n    const currentPath = cwd()\n\n    let path = sniffForPath() ?? currentPath\n    // Hydrogen CI uses `hydrogen/hydrogen` path, while local dev uses `shopify/hydrogen`.\n    const currentPathMightBeHydrogenMonorepo = /(shopify|hydrogen)\\/hydrogen/i.test(currentPath)\n    const ignoreHydrogenMonorepo = process.env.IGNORE_HYDROGEN_MONOREPO\n    if (currentPathMightBeHydrogenMonorepo && !ignoreHydrogenMonorepo) {\n      path = execaSync('npm', ['prefix']).stdout.trim()\n    }\n    if (fileExistsSync(joinPath(path, 'package.json'))) {\n      // Hydrogen is bundled, but we still want to support loading it as an external plugin for two reasons:\n      // 1. To allow users to use an older version of Hydrogen. (to not force upgrades)\n      // 2. To allow the Hydrogen team to load a local version for testing.\n      options.pluginAdditions = {\n        core: ['@shopify/cli-hydrogen'],\n        path,\n      }\n    }\n    super(options)\n\n    // @ts-expect-error: This is a private method that we are overriding. OCLIF doesn't provide a way to extend it.\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    this.determinePriority = this.customPriority\n  }\n\n  customPriority(commands: Command.Loadable[]): Command.Loadable | undefined {\n    const oclifPlugins = this.pjson.oclif.plugins ?? []\n    const commandPlugins = commands.sort((aCommand, bCommand) => {\n      // eslint-disable-next-line no-restricted-syntax\n      const pluginAliasA = aCommand.pluginAlias ?? 'A-Cannot-Find-This'\n      // eslint-disable-next-line no-restricted-syntax\n      const pluginAliasB = bCommand.pluginAlias ?? 'B-Cannot-Find-This'\n      const aIndex = oclifPlugins.indexOf(pluginAliasA)\n      const bIndex = oclifPlugins.indexOf(pluginAliasB)\n\n      // If there is an external cli-hydrogen plugin, its commands should take priority over bundled ('core') commands\n      if (aCommand.pluginType === 'core' && bCommand.pluginAlias === '@shopify/cli-hydrogen') {\n        // If b is hydrogen and a is core sort b first\n        return 1\n      }\n\n      if (aCommand.pluginAlias === '@shopify/cli-hydrogen' && bCommand.pluginType === 'core') {\n        // If a is hydrogen and b is core sort a first\n        return -1\n      }\n\n      // All other cases are the default implementation from the private `determinePriority` method\n      // When both plugin types are 'core' plugins sort based on index\n      if (aCommand.pluginType === 'core' && bCommand.pluginType === 'core') {\n        // If b appears first in the pjson.plugins sort it first\n        return aIndex - bIndex\n      }\n\n      // if b is a core plugin and a is not sort b first\n      if (bCommand.pluginType === 'core' && aCommand.pluginType !== 'core') {\n        return 1\n      }\n\n      // if a is a core plugin and b is not sort a first\n      if (aCommand.pluginType === 'core' && bCommand.pluginType !== 'core') {\n        return -1\n      }\n\n      // if a is a jit plugin and b is not sort b first\n      if (aCommand.pluginType === 'jit' && bCommand.pluginType !== 'jit') {\n        return 1\n      }\n\n      // if b is a jit plugin and a is not sort a first\n      if (bCommand.pluginType === 'jit' && aCommand.pluginType !== 'jit') {\n        return -1\n      }\n\n      // neither plugin is core, so do not change the order\n      return 0\n    })\n    return commandPlugins[0]\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAGA,kBAA8B,2BAGjB,gBAAP,cAA6B,mBAAM;EACvC,YAAY,SAAgB;AAC1B,QAAM,cAAc,IAAG,GAEnB,OAAO,aAAY,KAAM,aAEvB,qCAAqC,gCAAgC,KAAK,WAAW,GACrF,yBAAyB,QAAQ,IAAI;AAC3C,IAAI,sCAAsC,CAAC,2BACzC,OAAO,UAAU,OAAO,CAAC,QAAQ,CAAC,EAAE,OAAO,KAAI,IAE7C,eAAe,SAAS,MAAM,cAAc,CAAC,MAI/C,QAAQ,kBAAkB;MACxB,MAAM,CAAC,uBAAuB;MAC9B;QAGJ,MAAM,OAAO,GAIb,KAAK,oBAAoB,KAAK;EAChC;EAEA,eAAe,UAA4B;AACzC,QAAM,eAAe,KAAK,MAAM,MAAM,WAAW,CAAA;AAkDjD,WAjDuB,SAAS,KAAK,CAAC,UAAU,aAAY;AAE1D,UAAM,eAAe,SAAS,eAAe,sBAEvC,eAAe,SAAS,eAAe,sBACvC,SAAS,aAAa,QAAQ,YAAY,GAC1C,SAAS,aAAa,QAAQ,YAAY;AAGhD,aAAI,SAAS,eAAe,UAAU,SAAS,gBAAgB,0BAEtD,IAGL,SAAS,gBAAgB,2BAA2B,SAAS,eAAe,SAEvE,KAKL,SAAS,eAAe,UAAU,SAAS,eAAe,SAErD,SAAS,SAId,SAAS,eAAe,UAAU,SAAS,eAAe,SACrD,IAIL,SAAS,eAAe,UAAU,SAAS,eAAe,SACrD,KAIL,SAAS,eAAe,SAAS,SAAS,eAAe,QACpD,IAIL,SAAS,eAAe,SAAS,SAAS,eAAe,QACpD,KAIF;IACT,CAAC,EACqB,CAAC;EACzB;;",
  "names": []
}
